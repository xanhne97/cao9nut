<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>BÃ i CÃ o Online</title>
<script src="/socket.io/socket.io.js"></script>

<style>
body{
  font-family:Arial;
  text-align:center;
  background:linear-gradient(135deg,#0b5,#063);
  color:#fff;
}

.card-wrap{
  display:flex;
  justify-content:center;
  gap:15px;
  margin:20px;
}

.card{
  width:80px;
  height:120px;
  perspective:600px;
}

.inner{
  width:100%;
  height:100%;
  position:relative;
  transform-style:preserve-3d;
  transition:0.6s;
}

.flip .inner{
  transform:rotateY(180deg);
}

.front,.back{
  position:absolute;
  width:100%;
  height:100%;
  border-radius:10px;
  backface-visibility:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:22px;
  font-weight:bold;
}

.back{
  background:#fff;
  color:#000;
  border:2px solid #333;
  transform:rotateY(180deg);
}

.front{
  background:url('https://upload.wikimedia.org/wikipedia/commons/thumb/5/54/Card_back_05.svg/200px-Card_back_05.svg.png');
  background-size:cover;
}

button{
  padding:10px 20px;
  font-size:16px;
  border:none;
  border-radius:6px;
  cursor:pointer;
}
</style>
</head>

<body>

<h2>ğŸƒ BÃ i CÃ o Online</h2>

<input id="name" placeholder="TÃªn báº¡n">
<button onclick="join()">VÃ o bÃ n</button>

<div id="players"></div>

<button id="dealBtn" onclick="deal()" style="display:none">Chia bÃ i (Host)</button>

<h3>BÃ i cá»§a báº¡n</h3>
<div class="card-wrap" id="cards"></div>

<button onclick="reveal()">Láº­t bÃ i</button>

<div id="result"></div>

<h3>ğŸ“œ Nháº­t kÃ½ bÃ n</h3>
<div id="logBox" style="height:120px;overflow:auto;background:#0003;padding:10px"></div>

<h3>ğŸ… Báº£ng Ä‘iá»ƒm</h3>
<div id="scoreBox"></div>

<script>
const socket=io();
let myCards=[];

const suits=["â™ ","â™¥","â™¦","â™£"];
const ranks=["A","2","3","4","5","6","7","8","9","10","J","Q","K"];

function join(){
  socket.emit("join",document.getElementById("name").value);
}

function deal(){ socket.emit("deal"); }

function reveal(){
  document.querySelectorAll(".card").forEach(c=>c.classList.add("flip"));
  socket.emit("reveal");
}

socket.on("players",(list)=>{
  document.getElementById("players").innerHTML=
    "NgÆ°á»i chÆ¡i: "+list.map(p=>p.name).join(", ");
});

socket.on("yourCards",(cards)=>{
  myCards=cards;
  renderCards(false);
});

function renderCards(show){
  let html="";
  myCards.forEach((c,i)=>{
    let rank=ranks[(c-1)%13];
    let suit=suits[Math.floor(Math.random()*4)];
    html+=`
      <div class="card ${show?"flip":""}">
        <div class="inner">
          <div class="front"></div>
          <div class="back">${rank}${suit}</div>
        </div>
      </div>
    `;
  });
  document.getElementById("cards").innerHTML=html;
}
socket.on("players",(data)=>{
  document.getElementById("players").innerHTML=
    "Host: "+(data.host||"")+
    "<br>NgÆ°á»i chÆ¡i: "+data.list.map(p=>p.name).join(", ");
});

socket.on("isHost",(v)=>{
  document.getElementById("dealBtn").style.display=v?"inline-block":"none";
});
socket.on("showAll",(players)=>{
  let html="<h3>Káº¿t quáº£</h3>";
  Object.values(players).forEach(p=>{
    html+=`<p>${p.name}: ${p.cards.join("-")} â†’ ${p.score==0?"BÃ¹":p.score}</p>`;
  });
  document.getElementById("result").innerHTML=html;
});
socket.on("log",(msg)=>{
  let box=document.getElementById("logBox");
  box.innerHTML+="<div>"+msg+"</div>";
  box.scrollTop=box.scrollHeight;
});

socket.on("scoreboard",(list)=>{
  let html="<table border='1' style='margin:auto;background:#fff;color:#000'>";
  html+="<tr><th>TÃªn</th><th>Äiá»ƒm tháº¯ng</th></tr>";
  list.forEach(p=>{
    html+=`<tr><td>${p.name}</td><td>${p.total}</td></tr>`;
  });
  html+="</table>";
  document.getElementById("scoreBox").innerHTML=html;
});

socket.on("winner",(w)=>{
  document.getElementById("result").innerHTML+=
    `<h2>ğŸ† ${w.winner} tháº¯ng (${w.max==0?"BÃ¹":w.max})</h2>`;
});
</script>

</body>
</html>